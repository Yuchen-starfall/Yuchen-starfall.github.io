<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="Hexo Theme Redefine"><meta name="author" content="Yuchen"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="canonical" href="http://example.com/2024/12/15/organelle assemble/"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="revisit-after" content="1 days"><meta name="description" content="Hexo Theme Redefine, Redefine Your Hexo Journey."><meta property="og:type" content="article"><meta property="og:title" content="Organelle assemble"><meta property="og:url" content="http://example.com/2024/12/15/Organelle%20assemble/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="Hexo Theme Redefine, Redefine Your Hexo Journey."><meta property="og:locale" content="en_US"><meta property="og:image" content="http://example.com/images/redefine-og.webp"><meta property="article:published_time" content="2024-12-15T11:33:00.000Z"><meta property="article:modified_time" content="2025-06-16T03:01:48.785Z"><meta property="article:author" content="John Doe"><meta property="article:tag" content="Assemble"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/images/redefine-og.webp"><link rel="icon" type="image/png" href="/images/profile.jpg" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/profile.jpg"><meta name="theme-color" content="#A31F34"><link rel="shortcut icon" href="/images/profile.jpg"><title>Organelle assemble | Steps Among the Stars</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/fonts/Chillax/chillax.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/css/build/tailwind.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/fonts/GeistMono/geist-mono.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/fonts/Geist/geist.css"><script id="hexo-configurations">window.config={hostname:"example.com",root:"/",language:"en"},window.theme={articles:{style:{font_size:"16px",line_height:1.5,image_border_radius:"14px",image_alignment:"center",image_caption:!1,link_icon:!0,delete_mask:!1,title_alignment:"left",headings_top_spacing:{h1:"3.2rem",h2:"2.4rem",h3:"1.9rem",h4:"1.6rem",h5:"1.4rem",h6:"1.3rem"}},word_count:{enable:!0,count:!0,min2read:!0},author_label:{enable:!1,auto:!1,list:[]},code_block:{copy:!0,style:"mac",highlight_theme:{light:"github",dark:"vs2015"},font:{enable:!1,family:null,url:null}},toc:{enable:!0,max_depth:6,number:!1,expand:!0,init_open:!0},copyright:{enable:!0,default:"CC BY-NC-ND"},lazyload:!0,pangu_js:!1,recommendation:{enable:!1,title:"推荐阅读",limit:3,mobile_limit:2,placeholder:"/images/wallhaven-wqery6-light.webp",skip_dirs:[]}},colors:{primary:"#A31F34",secondary:null,default_mode:"light"},global:{fonts:{chinese:{enable:!1,family:null,url:null},english:{enable:!1,family:null,url:null},title:{enable:!1,family:null,url:null}},content_max_width:"1000px",sidebar_width:"210px",hover:{shadow:!0,scale:!1},scroll_progress:{bar:!1,percentage:!1},website_counter:{url:"https://cn.vercount.one/js",enable:!0,site_pv:!0,site_uv:!0,post_pv:!0},single_page:!0,preloader:{enable:"ture",custom_message:"Welcome to my little corner of chaos and brilliance!"},open_graph:{enable:!0,image:"/images/redefine-og.webp",description:"Hexo Theme Redefine, Redefine Your Hexo Journey."},google_analytics:{enable:!1,id:null}},home_banner:{enable:!0,style:"fixed",image:{light:"/images/light.jpeg",dark:"/images/dark.png"},title:"Resonant Journals",subtitle:{text:["Welcome to my little corner of chaos and brilliance!"],hitokoto:{enable:!1,show_author:!1,api:"https://v1.hitokoto.cn"},typing_speed:20,backing_speed:80,starting_delay:500,backing_delay:1500,loop:!1,smart_backspace:!0},text_color:{light:"#fff",dark:"#d1d1b6"},text_style:{title_size:"2.8rem",subtitle_size:"1.5rem",line_height:1.2},custom_font:{enable:!1,family:null,url:null},social_links:{enable:"ture",style:"default",links:{github:null,instagram:null,zhihu:null,twitter:null,email:"yuchen.starfall@outlook.com"},qrs:{weixin:null}}},plugins:{feed:{enable:!1},aplayer:{enable:!1,type:"fixed",audios:[{name:null,artist:null,url:null,cover:null,lrc:null}]},mermaid:{enable:!1,version:"11.4.1"}},version:"2.8.2",navbar:{auto_hide:"ture",color:{left:"#f78736",right:"#367df7",transparency:35},width:{home:"1200px",pages:"1000px"},links:{Home:{path:"/",icon:"fa-regular fa-house"},Archives:{path:"/archives",icon:"fa-regular fa-archive"},Categories:{icon:"fa-solid fa-folder",path:"/categories/"},Tags:{icon:"fa-solid fa-tags",path:"/tags/"}},search:{enable:!1,preload:!0}},page_templates:{friends_column:2,tags_style:"blur"},home:{sidebar:{enable:!0,position:"left",first_item:"menu",announcement:"Ephemeral Trails",show_on_mobile:!0,links:{Archives:{path:"/archives",icon:"fa-regular fa-archive"},Tags:{path:"/tags",icon:"fa-regular fa-tags"},Categories:{path:"/categories",icon:"fa-regular fa-folder"}}},article_date_format:"auto",excerpt_length:200,categories:{enable:!0,limit:3},tags:{enable:!0,limit:3}},footerStart:"2024/12/5 00:00:00"},window.lang_ago={second:"%s seconds ago",minute:"%s minutes ago",hour:"%s hours ago",day:"%s days ago",week:"%s weeks ago",month:"%s months ago",year:"%s years ago"},window.data={masonry:!0}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/fontawesome/brands.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/fontawesome/solid.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/fontawesome/regular.min.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div class="progress-bar-container"><span class="pjax-progress-bar"></span></div><main class="page-container" id="swup"><div class="main-content-container flex flex-col justify-between min-h-dvh"><div class="main-content-header"><header class="navbar-container px-6 md:px-12"><div class="navbar-content transition-navbar"><div class="left"><a class="logo-title" href="/">Steps Among the Stars</a></div><div class="right"><div class="desktop"><ul class="navbar-list"><li class="navbar-item"><a href="/"><i class="fa-regular fa-house fa-fw"></i> HOME</a></li><li class="navbar-item"><a href="/archives"><i class="fa-regular fa-archive fa-fw"></i> ARCHIVES</a></li><li class="navbar-item"><a href="/categories/"><i class="fa-solid fa-folder fa-fw"></i> CATEGORIES</a></li><li class="navbar-item"><a href="/tags/"><i class="fa-solid fa-tags fa-fw"></i> TAGS</a></li></ul></div><div class="mobile"><div class="icon-item navbar-bar"><div class="navbar-bar-middle"></div></div></div></div></div><div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between"><ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start"><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/"><span>HOME </span><i class="fa-regular fa-house fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/archives"><span>ARCHIVES </span><i class="fa-regular fa-archive fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/categories/"><span>CATEGORIES </span><i class="fa-solid fa-folder fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/tags/"><span>TAGS </span><i class="fa-solid fa-tags fa-sm fa-fw"></i></a></li></ul><div class="statistics flex justify-around my-2.5"><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">48</div><div class="label text-third-text-color text-sm">Tags</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">7</div><div class="label text-third-text-color text-sm">Categories</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">53</div><div class="label text-third-text-color text-sm">Posts</div></a></div></div><div class="window-mask"></div></header></div><div class="main-content-body transition-fade-up"><div class="main-content"><div class="post-page-container flex relative justify-between box-border w-full h-full"><div class="article-content-container"><div class="article-title relative w-full"><div class="w-full flex items-center pt-6 justify-start"><h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">Organelle assemble</h1></div></div><div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8"><div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]"><img src="/images/profile.jpg"></div><div class="info flex flex-col justify-between"><div class="author flex items-center"><span class="name text-default-text-color text-lg font-semibold">Yuchen</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-pen-fancy"></i>&nbsp; <span class="desktop">2024-12-15 19:33</span> <span class="mobile">2024-12-15 19:33</span> <span class="hover-info">Created</span> </span><span class="article-date article-meta-item"><i class="fa-regular fa-wrench"></i>&nbsp; <span class="desktop">2025-06-16 11:01:48</span> <span class="mobile">2025-06-16 11:01:48</span> <span class="hover-info">Updated</span> </span><span class="article-categories article-meta-item"><i class="fa-regular fa-folders"></i>&nbsp;<ul><li><a href="/categories/Genomics/">Genomics</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fa-regular fa-tags"></i>&nbsp;<ul><li><a href="/tags/Assemble/">Assemble</a>&nbsp;</li></ul></span><span class="article-pv article-meta-item"><i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8"><h2 id="Purpose"><a href="#Purpose" class="headerlink" title="Purpose"></a>Purpose</h2><p>由于NGS技术短读长的特点，在面对拥有这大量长片段的重复序列的线粒体基因组时，使用二代测序&#x2F;二代三代测序数据混装的细胞器基因组的效果不佳。三代测序发展的今天，尝试重新组装线粒体基因组。最终目的是<strong>使用最少的reads</strong>去组装出一个<strong>与参考基因组覆盖度最高</strong>的细胞器基因组。</p><p><img lazyload src="/images/loading.svg" data-src="/img/img-organelle_assemble/1.png" alt="mt_genome"></p><h2 id="Technical-route"><a href="#Technical-route" class="headerlink" title="Technical route"></a>Technical route</h2><p><img lazyload src="/images/loading.svg" data-src="/img/img-organelle_assemble/2.png" alt="technical_route"></p><h2 id="Process"><a href="#Process" class="headerlink" title="Process"></a>Process</h2><h3 id="Filter-contig-from-genome"><a href="#Filter-contig-from-genome" class="headerlink" title="Filter contig from genome"></a>Filter contig from genome</h3><h4 id="Purpose-1"><a href="#Purpose-1" class="headerlink" title="Purpose"></a>Purpose</h4><p>已有，预组装的基因组.fa文件。将高通量HiFi测序reads 组装为contig。将预组装基因组文件与参考基因组比对，筛选出大于80%的contig，将筛选出的contig放入一个文件，为下一步做准备。</p><h4 id="Software"><a href="#Software" class="headerlink" title="Software"></a>Software</h4><h5 id="MUMmer"><a href="#MUMmer" class="headerlink" title="MUMmer"></a>MUMmer</h5><p><code>MUMmer</code>中的<code>nucmer</code>用于对多 Fasta 数据文件中包含的核苷酸序列进行全部与全部比较。它最适合用于可能具有大量重排的相似序列。<code>promer</code>用于蛋白质水平，核苷酸输入文件在所有 6 个阅读框架中翻译，然后通过与 nucmer 相同的方法相互对齐。</p><p><code>nucmer [options] &lt;reference&gt; &lt;query&gt;</code></p><ul><li>-p：指定输出文件前缀</li><li>–delta&#x3D;PATH：指定 .delta 文件的输出路径</li><li>–mum：使用在参考序列和查询序列中都唯一的锚点进行比对</li><li>–maxmatch：使用所有的锚点进行比对，而不考虑唯一性</li></ul><p><code>show-coords -r -T &lt;out.delta&gt;</code></p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;reference geneme location&gt; &lt;query genome location&gt;</span><br><span class="line">NUCMER</span><br><span class="line"></span><br><span class="line">[S1]    [E1]    [S2]    [E2]    [LEN 1] [LEN 2] [% IDY] [LEN R] [LEN Q] [COV R] [COV Q] [TAGS]</span><br><span class="line">31099   60341   273647  244407  29243   29241   99.88   222059  490520  13.17   5.96    ptg000001l      BA000029.3</span><br><span class="line">60334   70901   195395  184828  10568   10568   100.00  222059  490520  4.76    2.15    ptg000001l      BA000029.3</span><br><span class="line">70905   85506   184860  170251  14602   14610   99.86   222059  490520  6.58    2.98    ptg000001l      BA000029.3</span><br><span class="line">85499   95965   41369   51835   10467   10467   99.50   222059  490520  4.71    2.13    ptg000001l      BA000029.3</span><br><span class="line">85499   90763   135896  141160  5265    5265    99.98   222059  490520  2.37    1.07    ptg000001l      BA000029.3</span><br></pre></td></tr></table></figure></div><div class="code-container" data-rel="Txt"><figure class="iseeu highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[S1]    Start of the alignment region in the reference sequence.</span><br><span class="line"></span><br><span class="line">[E1]    End of the alignment region in the reference sequence.</span><br><span class="line"></span><br><span class="line">[S2]    Start of the alignment region in the query sequence.</span><br><span class="line"></span><br><span class="line">[E2]    End of the alignment region in the query sequence.</span><br><span class="line"></span><br><span class="line">[LEN 1] Length of the alignment region in the reference sequence,measured in nucleotides.</span><br><span class="line"></span><br><span class="line">[LEN 2] Length of the alignment region in the query sequence, measured in nucleotides.</span><br><span class="line"></span><br><span class="line">[% IDY] Percent identity of the alignment, calculated as the(number of exact matches) / ([LEN 1] + insertions in the query).</span><br><span class="line"></span><br><span class="line">[% SIM] Percent similarity of the alignment, calculated like the above value, but counting positive BLOSUM matrix scores instead of exact matches.</span><br><span class="line"></span><br><span class="line">[% STP] Percent of stop codons of the alignment, calculated as(number of stop codons) / (([LEN 1] + insertions in the query) * 2).</span><br><span class="line"></span><br><span class="line">[LEN R] Length of the reference sequence.</span><br><span class="line"></span><br><span class="line">[LEN Q] Length of the query sequence.</span><br><span class="line"></span><br><span class="line">[COV R] Percent coverage of the alignment on the reference sequence, calculated as [LEN 1] / [LEN R].</span><br><span class="line"></span><br><span class="line">[COV Q] Percent coverage of the alignment on the query sequence, calculated as [LEN 2] / [LEN Q].</span><br><span class="line"></span><br><span class="line">[FRM]   Reading frame for the reference sequence and the reading frame for the query sequence respectively.  This is one of the columns absent from the nucmer data, however, match direction can easily be determined by the start and end coordinates.</span><br><span class="line"></span><br><span class="line">[TAGS]  The reference FastA ID and the query FastA ID.</span><br></pre></td></tr></table></figure></div><h5 id="seqtk"><a href="#seqtk" class="headerlink" title="seqtk"></a>seqtk</h5><p>seqtk 是一个使用C语言编写的轻量级的工具集，专门用于处理 FASTA 和 FASTQ 格式的生物序列数据。它非常适合用于大规模基因组数据的处理，能够高效地处理和转换序列数据。</p><ol><li><strong>提取子序列：</strong> 从 FASTA&#x2F;FASTQ 文件中提取特定的序列（例如基于 ID 提取 reads）。</li></ol><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seqtk subseq input.fastq reads_ids.txt &gt; output.fastq</span><br></pre></td></tr></table></figure></div><ol start="2"><li><strong>格式转换：</strong> 转换序列文件的格式，例如从 FASTQ 转为 FASTA，或者反向转换。</li></ol><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seqtk seq -a input.fastq &gt; output.fasta</span><br></pre></td></tr></table></figure></div><ol start="3"><li><strong>抽样：</strong> 从大数据集中随机抽取子集（比如抽取部分 数量reads 进行分析）。</li></ol><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seqtk sample input.fastq 1000 &gt; sample.fastq</span><br></pre></td></tr></table></figure></div><ol start="4"><li><strong>质量控制：</strong> 剔除低质量的序列或 reads。保留平均质量值大于等于 20 的 reads，质量值是根据 ASCII 码计算</li></ol><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seqtk seq -q 20 input.fastq &gt; filtered.fastq</span><br></pre></td></tr></table></figure></div><ol start="5"><li><strong>合并文件：</strong> 将多个 FASTA&#x2F;FASTQ 文件合并为一个。</li></ol><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">seqtk seq -A file1.fasta file2.fasta file3.fasta &gt; merged.fasta</span><br><span class="line">seqtk seq -q 20 file1.fastq file2.fastq file3.fastq &gt; merged.fastq</span><br></pre></td></tr></table></figure></div><h4 id="Pipeline"><a href="#Pipeline" class="headerlink" title="Pipeline"></a>Pipeline</h4><div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nucmer -p &lt;output name&gt; &lt;reference genome&gt; &lt;query genome&gt;</span><br></pre></td></tr></table></figure></div><div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show-coords -r -T -l -c &lt;out.delta&gt; | <span class="built_in">sort</span> -k12,12 -k1,1n &gt; &lt;filter.txt&gt;</span><br></pre></td></tr></table></figure></div><ul><li>-r：对输出的比对结果按参考序列的坐标<strong>升序</strong>排序。（默认情况下，比对结果是按照输入顺序输出的）</li><li>-T：启用制表符分隔输出（Tab-delimited output）。（默认的输出是用空格对齐的文本格式，阅读起来比较直观，但不便于程序解析）</li><li>-l：包含序列长度信息 – LEN R和LEN Q</li><li>-c ：包含覆盖度信息 – COV R和COV Q</li></ul><p><code>sort -k12,12 -k1,1n</code>这个命令会根据两个排序条件来排序文件：</p><ol><li><strong>按第12列排序</strong>：-k12,12 指定首先按第9列（字段）进行排序，这是主要的排序条件。</li><li><strong>按第1列进行数字排序</strong>：-k1,1n 指定在第9列排序后，对于第1列（字段）进行数字排序（n 表示按数字大小排序，而不是按字母顺序）。</li></ol><p>统计每条contig的覆盖度</p><div class="note-large blue"><div class="notel-title rounded-t-lg p-3 font-bold text-lg flex flex-row gap-2 items-center"><p>提示</p></div><div class="notel-content"><p>简单的累加同一条contig中的COV R或COV Q的值，特别是在同一 contig 上有多个匹配段且这些段之间存在重叠的情况下，重复计算这些重叠区域会导致覆盖度被高估。</p></div></div><p><code>python &lt;coberage.py&gt; &lt;input.txt&gt; &lt;output.txt&gt;</code></p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义函数：合并区间</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge_intervals</span>(<span class="params">intervals</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> intervals:</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    <span class="comment"># 按起点排序</span></span><br><span class="line">    intervals.sort()</span><br><span class="line">    merged = [intervals[<span class="number">0</span>]]</span><br><span class="line">    <span class="keyword">for</span> current <span class="keyword">in</span> intervals[<span class="number">1</span>:]:</span><br><span class="line">        prev_start, prev_end = merged[-<span class="number">1</span>]</span><br><span class="line">        curr_start, curr_end = current</span><br><span class="line">        <span class="keyword">if</span> curr_start &lt;= prev_end:  <span class="comment"># 存在重叠</span></span><br><span class="line">            merged[-<span class="number">1</span>] = (prev_start, <span class="built_in">max</span>(prev_end, curr_end))  <span class="comment"># 合并区间</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            merged.append(current)  <span class="comment"># 新的区间</span></span><br><span class="line">    <span class="keyword">return</span> merged</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取输入文件</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_file</span>(<span class="params">file_path</span>):</span><br><span class="line">    contig_intervals = defaultdict(<span class="built_in">list</span>)  <span class="comment"># 用于存储每个参考序列的比对区间</span></span><br><span class="line">    contig_lengths = &#123;&#125;  <span class="comment"># 用于存储每个参考序列的总长度 (LEN R)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">             <span class="comment"># 跳过前四行 -- delta格式决定</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            <span class="built_in">next</span>(file)</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> file:</span><br><span class="line">            <span class="comment"># 跳过表头或空行</span></span><br><span class="line">            <span class="keyword">if</span> line.strip() == <span class="string">&quot;&quot;</span> <span class="keyword">or</span> re.<span class="keyword">match</span>(<span class="string">r&quot;^\[S1\]&quot;</span>, line):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 按制表符分割每一行</span></span><br><span class="line">            cols = line.strip().split(<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">            start, end = <span class="built_in">int</span>(cols[<span class="number">0</span>]), <span class="built_in">int</span>(cols[<span class="number">1</span>])  <span class="comment"># S1, E1</span></span><br><span class="line">            contig = cols[<span class="number">11</span>]  <span class="comment"># TAGS 中的参考序列名称</span></span><br><span class="line">            length_r = <span class="built_in">int</span>(cols[<span class="number">7</span>])  <span class="comment"># LEN R</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 添加区间到对应参考序列</span></span><br><span class="line">            contig_intervals[contig].append((start, end))</span><br><span class="line">            <span class="comment"># 记录参考序列的总长度</span></span><br><span class="line">            contig_lengths[contig] = length_r</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> contig_intervals, contig_lengths</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算覆盖度</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_coverage</span>(<span class="params">contig_intervals, contig_lengths</span>):</span><br><span class="line">    coverage_results = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> contig, intervals <span class="keyword">in</span> contig_intervals.items():</span><br><span class="line">        merged_intervals = merge_intervals(intervals)</span><br><span class="line">        total_coverage = <span class="built_in">sum</span>(end - start + <span class="number">1</span> <span class="keyword">for</span> start, end <span class="keyword">in</span> merged_intervals)</span><br><span class="line">        reference_length = contig_lengths[contig]</span><br><span class="line">        coverage_percentage = (total_coverage / reference_length) * <span class="number">100</span></span><br><span class="line">        coverage_results[contig] = (total_coverage, coverage_percentage)</span><br><span class="line">    <span class="keyword">return</span> coverage_results</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主程序</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 设置命令行参数解析</span></span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&quot;Calculate the coverage of reference sequences based on nucmer output.&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;input_file&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;Path to the input txt file containing nucmer coordinates.&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;output_file&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;Path to the output file where results will be saved.&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 解析输入文件</span></span><br><span class="line">    contig_intervals, contig_lengths = parse_file(args.input_file)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 计算覆盖度</span></span><br><span class="line">    coverage_results = calculate_coverage(contig_intervals, contig_lengths)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 将结果保存到输出文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(args.output_file, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> output_file:</span><br><span class="line">        output_file.write(<span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;Contig&#x27;</span>:&lt;<span class="number">20</span>&#125;</span> <span class="subst">&#123;<span class="string">&#x27;Total Coverage&#x27;</span>:&lt;<span class="number">15</span>&#125;</span> <span class="subst">&#123;<span class="string">&#x27;Coverage (%)&#x27;</span>:&lt;<span class="number">15</span>&#125;</span>\n&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> contig, (total_coverage, coverage_percentage) <span class="keyword">in</span> coverage_results.items():</span><br><span class="line">            output_file.write(<span class="string">f&quot;<span class="subst">&#123;contig:&lt;<span class="number">20</span>&#125;</span> <span class="subst">&#123;total_coverage:&lt;<span class="number">15</span>&#125;</span> <span class="subst">&#123;coverage_percentage:<span class="number">.2</span>f&#125;</span>\n&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Results have been written to <span class="subst">&#123;args.output_file&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行脚本</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></div><p>最终的输出如下</p><div class="code-container" data-rel="Txt"><figure class="iseeu highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Contig               Total Coverage  Coverage (%)</span><br><span class="line">ptg000001l           152557          68.70</span><br><span class="line">ptg000002l           69997           86.49</span><br><span class="line">ptg000003l           38846           51.78</span><br><span class="line">ptg000004l           120567          82.39</span><br><span class="line">ptg000005l           46787           100.00</span><br></pre></td></tr></table></figure></div><p>筛选出大于80的contig ID</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;NR &gt; 1 &amp;&amp; $2 &gt;= 80 &#123;print $1&#125;&#x27; &lt;input.txt&gt; &gt; &lt;output_ID.txt&gt;</span><br></pre></td></tr></table></figure></div><p>根据ID提取序列</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seqtk subseq &lt;input.fastq&gt; &lt;contig_ids.txt&gt; &gt; &lt;extracted_contig.fastq&gt;</span><br></pre></td></tr></table></figure></div><h3 id="Filter-HiFi-reads"><a href="#Filter-HiFi-reads" class="headerlink" title="Filter HiFi reads"></a>Filter HiFi reads</h3><h4 id="Purpose-2"><a href="#Purpose-2" class="headerlink" title="Purpose"></a>Purpose</h4><p>将上一步得到的与参考基因组覆盖度大于80%的contig 整合在一起，与高通量测序比对，筛选出高覆盖度的reads，将reads提取出来，为后续的再组装做准备。</p><h4 id="Software-1"><a href="#Software-1" class="headerlink" title="Software"></a>Software</h4><h5 id="bedtools"><a href="#bedtools" class="headerlink" title="bedtools"></a>bedtools</h5><p>专门设计用于处理基因组数据，特别是基因组区域之间的交互、统计和分析。它支持多种常见的生物学数据格式，如 BED、GFF、VCF、BAM、SAM 等。bedtools 的核心功能包括对基因组区域的操作、格式转换、统计计算以及文件间的交互。</p><ul><li>寻找交集：<code>bedtools intersect -a file1.bed -b file2.bed</code></li><li>合并：<code>bedtools merge -i file.bed</code></li><li>计算覆盖度：<code>bedtools coverage -a regions.bed -b reads.bam</code></li><li>排序：<code>bedtools sort -i file.bed</code></li><li>BED文件转换为BAM：<code>bedtools bedtobam -i input.bed -g genome.txt &gt; output.bam</code></li><li>BAM文件转换为FASTQ格式：<code>bedtools bamtofastq -i input.bam -fq output.fastq</code></li></ul><p>BED格式文件</p><table><thead><tr><th><strong>字段</strong></th><th><strong>描述</strong></th><th><strong>必选</strong></th></tr></thead><tbody><tr><td>chrom</td><td>染色体名称或序列标识符</td><td>是</td></tr><tr><td>chromStart</td><td>区域的起始位置（0-based）</td><td>是</td></tr><tr><td>chromEnd</td><td>区域的结束位置（不包含chromEnd位置）</td><td>是</td></tr><tr><td>name</td><td>区域的名称或标识符（可选）</td><td>否</td></tr><tr><td>score</td><td>区域的得分（通常是0到1000之间的整数，可选）</td><td>否</td></tr><tr><td>strand</td><td>区域所在的链（+ 或 -，可选）</td><td>否</td></tr><tr><td>thickStart</td><td>编码区域的起始位置（可选）</td><td>否</td></tr><tr><td>thickEnd</td><td>编码区域的结束位置（可选）</td><td>否</td></tr><tr><td>itemRgb</td><td>RGB颜色值（可选）</td><td>否</td></tr><tr><td>blockCount</td><td>区域的块数（可选）</td><td>否</td></tr><tr><td>blockSizes</td><td>块的大小列表（可选）</td><td>否</td></tr><tr><td>blockStarts</td><td>块的起始位置列表（可选）</td><td>否</td></tr></tbody></table><h5 id="Minimap2"><a href="#Minimap2" class="headerlink" title="Minimap2"></a>Minimap2</h5><p>高效的序列比对工具，主要用于大规模基因组数据比对和长读（long-read）数据的对齐。它广泛应用于基因组学、转录组学、变异检测等领域，特别适合处理高通量测序数据，如短读（short-read）和长读（long-read）的比对。minimap2 的设计初衷是提供更快速、更准确的比对算法，特别适用于大规模基因组比对任务。</p><ul><li>-x [preset]<ul><li>-x map-ont：Oxford Nanopore 长读比对。</li><li>-x map-pb：PacBio 长读比对。</li><li>-x sr：短读比对（单端和双端）。</li><li>-x splice：带有剪接信息的 RNA-seq 比对。</li><li>-x map-hifi：PacBio HiFi&#x2F;CCS 比对</li></ul></li><li>-a 生成 SAM 格式的比对结果（标准输出格式）</li><li>-t [num] 指定使用的线程数，默认使用 1 个线程。增加线程数可以加快比对速度</li><li>-p [threshold] 设置比对的最小比对质量阈值，值越大，输出的比对结果越严格</li><li>查找长读的重叠<ul><li>PacBio：<code>minimap2 -x ava-pb reads.fq reads.fq &gt; ovlp.paf</code></li><li>Oxford Nanopore：<code>minimap2 -x ava-ont reads.fq reads.fq &gt; ovlp.paf</code></li></ul></li></ul><h5 id="BAM文件"><a href="#BAM文件" class="headerlink" title="BAM文件"></a>BAM文件</h5><p>BAM是目前基因数据分析中最通用的比对数据存储格式，它既适合于短read也适合于长read，最长可以支持128Mbp的超大read！BAM的纯文本格式（.sam）</p><p>查看BAM文件。不建议用VIM，会爆掉</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">less -SN in.sam          # 打开sam文件</span><br><span class="line">samtools view -h in.bam  # 打开bam文件</span><br></pre></td></tr></table></figure></div><p>BAM文件分为两个部分：header（@符号打头）和record（有时候也叫alignment section，即，<strong>比对信息</strong>）。这是我们通常所说的序列比对内容，<strong>每一行都是一条read比对信息</strong></p><table><thead><tr><th>字段名</th><th>描述</th></tr></thead><tbody><tr><td>QNAME</td><td>查询名称（Query name），读取的名称或 ID（标识符），用于区分不同的读取。</td></tr><tr><td>FLAG</td><td>标志（Flag），16 位整数，表示多种比对状态（如单端&#x2F;双端比对、反向比对等）。</td></tr><tr><td>RNAME</td><td>参考序列名称（Reference Name），比对到的参考基因组或染色体的名称。</td></tr><tr><td>POS</td><td>比对位置（Position），1-based，表示比对开始的位置。</td></tr><tr><td>MAPQ</td><td>比对质量（Mapping Quality），一个整数，表示比对结果的可靠性。</td></tr><tr><td>CIGAR</td><td>比对操作符（CIGAR），描述查询序列和参考基因组序列的匹配、插入、缺失等操作。</td></tr><tr><td>RNEXT</td><td>下一个比对的参考序列名称（Reference Name of Next Read），双端比对时表示另一端的参考序列名称。</td></tr><tr><td>PNEXT</td><td>下一个比对的位置（Position of Next Read），双端比对时表示另一端比对在参考基因组上的位置。</td></tr><tr><td>TLEN</td><td>模板长度（Template Length），表示该读取的模板长度，即双端之间的距离。</td></tr><tr><td>SEQ</td><td>序列（Sequence），表示该读取的碱基序列。</td></tr><tr><td>QUAL</td><td>序列质量分数（Quality Scores），每个碱基的质量分数，通常使用 Phred 质量分数来表示。</td></tr></tbody></table><h6 id="FLAG"><a href="#FLAG" class="headerlink" title="FLAG"></a>FLAG</h6><p><strong>FLAG</strong>信息很重要 – <strong>反应reads比对信息</strong></p><p>想要读懂它的一个关键点是我们<strong>不能够将其视为一个数字</strong>，而是<strong>必须将其转换为一串由0和1组成的二进制码</strong>，这一串二进制数中的每一个位(注意是“位”，bit的意思)都代表了一个特定信息，它一共有12位（以前只有8位），所以一般会用一个16位的整数来代表，这个整数的值就是12个0和1的组合计算得来的，因此它的数值范围是0~2048</p><table><thead><tr><th>标志位</th><th>二进制位</th><th>十六进制</th><th>解释</th></tr></thead><tbody><tr><td>1</td><td>0x1</td><td>0000001</td><td>模板有多个片段（template having multiple segments）</td></tr><tr><td>2</td><td>0x2</td><td>0000010</td><td>每个片段都已正确对齐（each segment properly aligned）</td></tr><tr><td>4</td><td>0x4</td><td>0000100</td><td>片段未对齐（segment unmapped）</td></tr><tr><td>8</td><td>0x8</td><td>0001000</td><td>下一个片段未对齐（next segment in the template unmapped）</td></tr><tr><td>16</td><td>0x10</td><td>0010000</td><td>序列反向互补（SEQ being reverse complemented）</td></tr><tr><td>32</td><td>0x20</td><td>0100000</td><td>下一个片段的序列是反向互补（SEQ of next segment reverse complemented）</td></tr><tr><td>64</td><td>0x40</td><td>1000000</td><td>该片段是模板中的第一个片段（first segment in the template）</td></tr><tr><td>128</td><td>0x80</td><td>10000000</td><td>该片段是模板中的最后一个片段（last segment in the template）</td></tr><tr><td>256</td><td>0x100</td><td>100000000</td><td>次级比对（secondary alignment）</td></tr><tr><td>512</td><td>0x200</td><td>1000000000</td><td>不通过质量过滤器（not passing filters）</td></tr><tr><td>1024</td><td>0x400</td><td>10000000000</td><td>PCR 或光学重复（PCR or optical duplicate）</td></tr><tr><td>2048</td><td>0x800</td><td>100000000000</td><td>补充比对（supplementary alignment）</td></tr></tbody></table><p>so 为看到一个序列的FLAG值为77。则77 &#x3D; 000001001101 &#x3D; 1 + 4 + 8 +64。因此得到这个这个FLAG包含的信息在一个由多个片段组成的模板序列中，<strong>第一个片段</strong>和<strong>最后一个片段</strong>可能会面临对齐失败的问题，其中不仅可能有某些片段没有成功比对到参考基因组，甚至可能是<strong>紧接着的下一个片段</strong>也会遇到对齐的问题。因此如果是0则代表完美匹配，没有附加任何额外的标志。</p><p><strong>我们要获得其中某个位（假设第N位）的值——只需要将这个FLAG值和2的N次方做与的运算即可</strong>。在与运算时，FLAG值首先会被转换成一串二进制序列（如77&#x3D;000001001101），而2的N次方除了第N位是1之外，其它的都是0，“与”了之后其它信息就会被屏蔽掉。比如，我们想知道该read是否比对上了参考序列，那么只需要计算FLAG &amp; 4 的值就行了，如果结果是1那么就是比对上了，如果是0则代表没有比上。假设我们想查看某个序列是否比对上了参考基因组。这个信息通常由FLAG值的第3位表示。在FLAG值的二进制表示中，第3位对应的是4，所以如果我们想知道序列是否比对成功，可以通过以下步骤：</p><ul><li>将FLAG值（比如77）和4做<strong>与运算</strong>。</li><li>FLAG &#x3D; 77 的二进制是 000001001101，4 的二进制是 000000000100。</li><li>77 &amp; 4 &#x3D; 000001001101 &amp; 000000000100 &#x3D; 000000000100，结果是 4（不为零）。</li></ul><p>如果结果不是零，说明该序列成功比对上了参考基因组。如果与运算结果是零，说明没有比对上。</p><h6 id="CIGAR"><a href="#CIGAR" class="headerlink" title="CIGAR"></a>CIGAR</h6><p>CIGAR是<code>C</code>ompact<code>I</code>diosyncratic<code>G</code>apped<code>A</code>lignment<code>R</code>eport的首字母缩写，称为“雪茄”字符串。<br><strong>作为一个字符串，它用数字和几个字符的组合形象记录了read比对到参考序列上的细节情况，读起来要比FLAG直观友好许多，只是记录的是不同的信息。</strong></p><table><thead><tr><th>Op</th><th>BAM</th><th>Description</th><th>Consumes Query</th><th>Consumes Reference</th></tr></thead><tbody><tr><td>M</td><td>0</td><td>alignment match (can be a sequence match or mismatch)</td><td>yes</td><td>yes</td></tr><tr><td>I</td><td>1</td><td>insertion to the reference</td><td>yes</td><td>no</td></tr><tr><td>D</td><td>2</td><td>deletion from the reference</td><td>no</td><td>yes</td></tr><tr><td>N</td><td>3</td><td>skipped region from the reference</td><td>no</td><td>yes</td></tr><tr><td>S</td><td>4</td><td>soft clipping (clipped sequences present in SEQ)</td><td>yes</td><td>no</td></tr><tr><td>H</td><td>5</td><td>hard clipping (clipped sequences NOT present in SEQ)</td><td>no</td><td>no</td></tr><tr><td>P</td><td>6</td><td>padding (silent deletion from padded reference)</td><td>no</td><td>no</td></tr><tr><td>&#x3D;</td><td>7</td><td>sequence match</td><td>yes</td><td>yes</td></tr><tr><td>X</td><td>8</td><td>sequence mismatch</td><td>yes</td><td>yes</td></tr></tbody></table><h6 id="MAPQ"><a href="#MAPQ" class="headerlink" title="MAPQ"></a>MAPQ</h6><p>MAPQ，比对质量值</p><p>它告诉我们的是这个read比对到参考序列上这个位置的可靠程度，用错误比对到该位置的概率值（转化为Phred scale）来描述：<br>$$<br>\text{MAPQ} &#x3D; -10 \times \log_{10}(P)<br>$$<br>因此MAPQ（mapping quality）值大于30就意味着错比概率低于0.001（千分之一），这个值也是我们衡量read比对质量的一个重要因子。</p><h4 id="Pipeline-1"><a href="#Pipeline-1" class="headerlink" title="Pipeline"></a>Pipeline</h4><p>hifi测序文件从bam，转化为fastq。</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bedtools bamtofastq -i &lt;hifi.bam&gt; -fq &lt;hifi_reads.fastq&gt;</span><br></pre></td></tr></table></figure></div><p>使用筛选出的contig与hifi reads进行比对</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">minimap2 -ax map-hifi &lt;extracted_contig.fastq&gt; &lt;hifi_reads.fastq&gt; &gt; &lt;reads.sam&gt;</span><br></pre></td></tr></table></figure></div><p>简单查看sam文件</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">samtools view -h &lt;reads.sam&gt; | head</span><br></pre></td></tr></table></figure></div><p>筛选出精确比对上的 – Flag&#x3D;0</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;if($2==0)print&#125;&#x27; &lt;reads.sam&gt; &gt; &lt;filter_reads.sam&gt;</span><br></pre></td></tr></table></figure></div><p>统计出来每条redas比对上的碱基数与覆盖率 – 即M的数量</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_line</span>(<span class="params">line</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> line.strip() != <span class="string">&quot;&quot;</span> <span class="keyword">and</span> <span class="keyword">not</span> line.startswith(<span class="string">&quot;#&quot;</span>):</span><br><span class="line"></span><br><span class="line">        parts = line.strip().split()</span><br><span class="line">        name = parts[<span class="number">0</span>]</span><br><span class="line">        cigar = parts[<span class="number">5</span>]</span><br><span class="line">        seq = parts[<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">        numbers_before_m = re.findall(<span class="string">r&#x27;(\d+)(?=M)&#x27;</span>, cigar)</span><br><span class="line">        sum1 = <span class="built_in">sum</span>(<span class="built_in">int</span>(num) <span class="keyword">for</span> num <span class="keyword">in</span> numbers_before_m)</span><br><span class="line">        sum2 = <span class="built_in">len</span>(seq)</span><br><span class="line"></span><br><span class="line">        ratio = sum1/sum2 <span class="keyword">if</span> <span class="built_in">sum</span> != <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> name, ratio</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_file</span>(<span class="params">inputfile, outfile1</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(inputfile, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> infile, <span class="built_in">open</span>(outfile1, <span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> out1:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> infile:</span><br><span class="line">            name, ratio = process_line(line)</span><br><span class="line">            out1.write(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span>\t<span class="subst">&#123;ratio&#125;</span>\n&quot;</span>)</span><br><span class="line">                       </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Usage: python sam_filter_coverage80.py &lt;input_file&gt; &lt;output_file1&gt;&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    inputfile = sys.argv[<span class="number">1</span>]</span><br><span class="line">    outfile1 = sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    process_file(inputfile, outfile1)</span><br></pre></td></tr></table></figure></div><p>筛选出大于80覆盖率的reads</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;if($2&gt;=0.8)print $1&#125;&#x27; &lt;coverage.txt&gt; &gt; &lt;coverage_id.txt&gt;</span><br></pre></td></tr></table></figure></div><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seqkit grep -f &lt;coverage_id.txt&gt; &lt;hifi_reads.fastq&gt; -o &lt;output.fastq&gt;</span><br></pre></td></tr></table></figure></div><h3 id="Assemble-genomes-at-different-sequencing-depths"><a href="#Assemble-genomes-at-different-sequencing-depths" class="headerlink" title="Assemble genomes at different sequencing depths"></a>Assemble genomes at different sequencing depths</h3><h4 id="Purpose-3"><a href="#Purpose-3" class="headerlink" title="Purpose"></a>Purpose</h4><p>查找到最优的深度来组装的细胞器基因组。较低的深度（如 30x 到 50x）通常足以生成高质量的基因组组装。在大多数情况下，30x 的深度对于二倍体物种（如人类、果蝇等）就已经足够。适当的测序深度可以帮助解决基因组中的低覆盖区域、复杂区域或重复区域，使得基因组的组装更加完整、准确。但随着测序深度的增加，<strong>冗余数据</strong>的比例也会增加，尤其是在短读测序的情况下。过多的重复信息会导致计算资源的浪费，增加数据处理的复杂度，特别是在组装和校正的阶段。而在长读测序（如 PacBio 或 Nanopore）中，过高的深度可能导致错误的重复区域（例如伪装的重复序列），这种冗余可能会使得组装变得更加困难。更高的测序深度意味着更多的测序数据、存储需求和处理时间。对于大规模基因组组装，成本也会显著上升，尤其是当目标物种非常庞大或复杂时。</p><h4 id="Software-2"><a href="#Software-2" class="headerlink" title="Software"></a>Software</h4><h5 id="hifiasm"><a href="#hifiasm" class="headerlink" title="hifiasm"></a>hifiasm</h5><p>是一个高效的基因组组装工具，专为 PacBio HiFi 数据设计，可以进行高质量的单倍型解析 de novo 组装。它可以在没有父母数据的情况下进行单倍型解析，并且能够处理 HiFi 读数、Hi-C 数据、以及超长 ONT 数据，用于获得高质量的全基因组装和双倍体基因组的组装。</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hifiasm -o &lt;output_name&gt; -t32 &lt;input_hifireads&gt;</span><br></pre></td></tr></table></figure></div><ul><li>-o NA12878.asm: 设置输出文件的前缀。</li><li>-t 32: 使用 32 个 CPU 核心。</li><li>-l0: 关闭重复去除（对于近交或同源基因组）。</li><li>–dual-scaf: 启用自我 scaffolding 来提高组装的连续性。</li><li>–h1 和 –h2: 提供 Hi-C 数据的配对文件，通常用于单倍型解析。</li><li>–ul file_name: 使用超长的 ONT 读数进行组装。</li><li>-f0: 禁用 Bloom filter，适用于小型基因组。</li></ul><h4 id="Pipeline-2"><a href="#Pipeline-2" class="headerlink" title="Pipeline"></a>Pipeline</h4><p>从总的reads中筛选出不同测序深度的reads为后续的组装做准备</p><p><code>python filter_reads_by_length.py &lt;input_file&gt; &lt;target_length&gt; &lt;output_file&gt;</code></p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter_reads_by_length</span>(<span class="params">input_file, target_length, output_file</span>):</span><br><span class="line">    <span class="comment"># 初始化变量</span></span><br><span class="line">    current_length = <span class="number">0</span></span><br><span class="line">    selected_reads = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 读取 FASTQ 文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(input_file, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> infile:</span><br><span class="line">        lines = infile.readlines()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取所有 reads 的索引</span></span><br><span class="line">    read_indices = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(lines), <span class="number">4</span>))</span><br><span class="line">    random.shuffle(read_indices)  <span class="comment"># 随机打乱</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 动态筛选 reads，直到达到目标长度</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> read_indices:</span><br><span class="line">        read = lines[i:i+<span class="number">4</span>]  <span class="comment"># 获取一个完整的 read</span></span><br><span class="line">        read_length = <span class="built_in">len</span>(read[<span class="number">1</span>].strip())  <span class="comment"># 第二行是序列</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> current_length + read_length &lt;= target_length:</span><br><span class="line">            selected_reads.extend(read)</span><br><span class="line">            current_length += read_length</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 写入输出文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(output_file, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> outfile:</span><br><span class="line">        outfile.writelines(selected_reads)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Selected <span class="subst">&#123;<span class="built_in">len</span>(selected_reads)//<span class="number">4</span>&#125;</span> reads with total length <span class="subst">&#123;current_length&#125;</span> bp&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 检查参数</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">4</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Usage: python script.py &lt;input_file&gt; &lt;target_length&gt; &lt;output_file&gt;&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取命令行参数</span></span><br><span class="line">    input_file = sys.argv[<span class="number">1</span>]</span><br><span class="line">    target_length = <span class="built_in">int</span>(sys.argv[<span class="number">2</span>])</span><br><span class="line">    output_file = sys.argv[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 运行过滤函数</span></span><br><span class="line">    filter_reads_by_length(input_file, target_length, output_file)</span><br></pre></td></tr></table></figure></div><p>基因组的组装</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hifiasm -o &lt;output name&gt; -t &lt;线程&gt; &lt;reads.fastq&gt;</span><br></pre></td></tr></table></figure></div><p>将组装后的gfa文件转化为fasta文件</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;/^S/&#123;print &quot;&gt;&quot;$2;print $3&#125;&#x27; &lt;.bp.p_ctg.gfa&gt; &gt; &lt;.fa&gt;</span><br></pre></td></tr></table></figure></div><h3 id="Visual-collinearity-analysis"><a href="#Visual-collinearity-analysis" class="headerlink" title="Visual collinearity analysis"></a>Visual collinearity analysis</h3><p>同理使用<code>nucmer</code>将梯度组装的基因组与参考基因组比对，可视化比对后相似区域的共线性分析</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nucmer -p &lt;output name&gt; &lt;genome1.fa&gt; &lt;genome2.fa&gt;</span><br></pre></td></tr></table></figure></div><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show-coords -r -T &lt;output.delta&gt; &gt; &lt;output.txt&gt;</span><br></pre></td></tr></table></figure></div><p>提取出所需可视化的部分</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;NR &gt; 4 &#123;print $1, $2, $8, $3, $4, $9&#125;&#x27; &lt;output.txt&gt; &gt; &lt;filter_output.txt&gt;</span><br></pre></td></tr></table></figure></div><p>参考delta文件格式。提取两个基因组分别比对上的区域。因为前4行没有信息，跳过前四行</p><p>提取出两个比对基因组的信息</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bioawk -c fastx &#x27;&#123; print $name, length($seq) &#125;&#x27; &lt;genome1&gt; &lt;genome2&gt; &gt; &lt;length.txt&gt;</span><br></pre></td></tr></table></figure></div><p>使用R脚本绘图</p><div class="code-container" data-rel="R"><figure class="iseeu highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载必要的包</span></span><br><span class="line">library<span class="punctuation">(</span>circlize<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>RColorBrewer<span class="punctuation">)</span> <span class="comment"># 好看的颜色！</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载基因组长度数据</span></span><br><span class="line">genome <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&quot;ength.txt&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">colnames<span class="punctuation">(</span>genome<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;chr&quot;</span><span class="punctuation">,</span> <span class="string">&quot;length&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 加载共线性数据</span></span><br><span class="line">synteny <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&quot;genome1_vs_genome2_link.txt&quot;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">colnames<span class="punctuation">(</span>synteny<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;query_start&quot;</span><span class="punctuation">,</span> <span class="string">&quot;query_end&quot;</span><span class="punctuation">,</span><span class="string">&quot;query_chr&quot;</span><span class="punctuation">,</span>  <span class="string">&quot;target_start&quot;</span><span class="punctuation">,</span> <span class="string">&quot;target_end&quot;</span><span class="punctuation">,</span> <span class="string">&quot;target_chr&quot;</span><span class="punctuation">)</span> <span class="comment"># 与我提取128349列有关</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 环</span></span><br><span class="line"><span class="comment"># 初始化染色体环形布局</span></span><br><span class="line">circos.initialize<span class="punctuation">(</span>factors <span class="operator">=</span> genome<span class="operator">$</span>chr<span class="punctuation">,</span> xlim <span class="operator">=</span> cbind<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> genome<span class="operator">$</span><span class="built_in">length</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制基因组的染色体信息</span></span><br><span class="line">circos.trackPlotRegion<span class="punctuation">(</span>factors <span class="operator">=</span> genome<span class="operator">$</span>chr<span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                       track.height <span class="operator">=</span> <span class="number">0.05</span><span class="punctuation">,</span>  <span class="comment"># 缩小边缘</span></span><br><span class="line">                       panel.fun <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">                         circos.text<span class="punctuation">(</span>CELL_META<span class="operator">$</span>xcenter<span class="punctuation">,</span> <span class="number">1.8</span><span class="punctuation">,</span> CELL_META<span class="operator">$</span>sector.index<span class="punctuation">,</span> </span><br><span class="line">                                     cex <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> adj <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span>  </span><br><span class="line">                       <span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 绘制共线性关系</span></span><br><span class="line">colors <span class="operator">&lt;-</span> brewer.pal<span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="string">&quot;Set3&quot;</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>unique<span class="punctuation">(</span>synteny<span class="operator">$</span>target_chr<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="comment"># 让一个也可以上色</span></span><br><span class="line"><span class="keyword">for</span><span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>nrow<span class="punctuation">(</span>synteny<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  color <span class="operator">&lt;-</span> colors<span class="punctuation">[</span>which<span class="punctuation">(</span>genome<span class="operator">$</span>chr <span class="operator">==</span> synteny<span class="operator">$</span>query_chr<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">%%</span> <span class="built_in">length</span><span class="punctuation">(</span>colors<span class="punctuation">)</span> <span class="operator">+</span> <span class="number">1</span><span class="punctuation">]</span>  <span class="comment"># 根据染色体选择颜色</span></span><br><span class="line">  circos.link<span class="punctuation">(</span>synteny<span class="operator">$</span>query_chr<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>synteny<span class="operator">$</span>query_start<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> synteny<span class="operator">$</span>query_end<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">              synteny<span class="operator">$</span>target_chr<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>synteny<span class="operator">$</span>target_start<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> synteny<span class="operator">$</span>target_end<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">              col <span class="operator">=</span> color<span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span>  <span class="comment"># 使用选定的颜色</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div><h3 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h3><p><img lazyload src="/images/loading.svg" data-src="/img/img-organelle_assemble/3.png" alt="resurt"></p></div><div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8"><div class="article-copyright-info-container"><ul><li><strong>Title:</strong> Organelle assemble</li><li><strong>Author:</strong> Yuchen</li><li><strong>Created at :</strong> 2024-12-15 19:33:00</li><li><strong>Updated at :</strong> 2025-06-16 11:01:48</li><li><strong>Link:</strong> https://yuchen-starfall.github.io/2024/12/15/Organelle assemble/</li><li><strong>License: </strong>This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.</li></ul></div></div><ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden"><li class="tag-item mx-0.5"><a href="/tags/Assemble/">#Assemble</a>&nbsp;</li></ul><div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8"><div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2"><a class="prev" rel="prev" href="/2024/12/16/Proteostasis/"><span class="left arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-left"></i> </span><span class="title flex justify-center items-center"><span class="post-nav-title-item">Proteostasis</span> <span class="post-nav-item">Prev posts</span></span></a></div><div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2"><a class="next" rel="next" href="/2024/12/14/Linux/"><span class="title flex justify-center items-center"><span class="post-nav-title-item">Foundation of Linux</span> <span class="post-nav-item">Next posts</span> </span><span class="right arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-right"></i></span></a></div></div><div class="comment-container px-2 sm:px-6 md:px-8 pb-8"><div class="comments-container mt-10 w-full"><div id="comment-anchor" class="w-full h-2.5"></div><div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">Comments</div><div id="giscus-container"></div><script data-swup-reload-script defer>async function loadGiscus(){const t={src:"https://giscus.app/client.js","data-repo":"Yuchen-starfall/Yuchen-starfall.github.io","data-repo-id":"R_kgDONY6r-Q","data-category":"Announcements# Github discussion category","data-category-id":"DIC_kwDONY6r-c4Ck8Zm","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"1","data-theme":"preferred_color_scheme","data-lang":"en","data-input-position":"bottom","data-loading":"lazy",crossorigin:"anonymous",async:!0},a=document.createElement("script");for(const e in t)a.setAttribute(e,t[e]);document.getElementById("giscus-container").appendChild(a)}{let t=setTimeout(()=>{loadGiscus(),clearTimeout(t)},1e3)}</script></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><div class="toc-title">On this page</div><div class="page-title">Organelle assemble</div><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Purpose"><span class="nav-text">Purpose</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Technical-route"><span class="nav-text">Technical route</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Process"><span class="nav-text">Process</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Filter-contig-from-genome"><span class="nav-text">Filter contig from genome</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Purpose-1"><span class="nav-text">Purpose</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Software"><span class="nav-text">Software</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#MUMmer"><span class="nav-text">MUMmer</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#seqtk"><span class="nav-text">seqtk</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Pipeline"><span class="nav-text">Pipeline</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Filter-HiFi-reads"><span class="nav-text">Filter HiFi reads</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Purpose-2"><span class="nav-text">Purpose</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Software-1"><span class="nav-text">Software</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#bedtools"><span class="nav-text">bedtools</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Minimap2"><span class="nav-text">Minimap2</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#BAM%E6%96%87%E4%BB%B6"><span class="nav-text">BAM文件</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#FLAG"><span class="nav-text">FLAG</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#CIGAR"><span class="nav-text">CIGAR</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#MAPQ"><span class="nav-text">MAPQ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Pipeline-1"><span class="nav-text">Pipeline</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Assemble-genomes-at-different-sequencing-depths"><span class="nav-text">Assemble genomes at different sequencing depths</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Purpose-3"><span class="nav-text">Purpose</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Software-2"><span class="nav-text">Software</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#hifiasm"><span class="nav-text">hifiasm</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Pipeline-2"><span class="nav-text">Pipeline</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Visual-collinearity-analysis"><span class="nav-text">Visual collinearity analysis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Result"><span class="nav-text">Result</span></a></li></ol></li></ol></div></div></div></div></div></div><div class="main-content-footer"><footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color"><div class="info-container py-3 text-center"><div class="text-center">&copy; <span>2024</span> - 2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration:0.5s;color:#f54545"></i>&nbsp;&nbsp;<a href="/">Yuchen</a><p class="post-count space-x-0.5"><span>53 posts in total</span></p></div><script data-swup-reload-script src="https://cn.vercount.one/js"></script><div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right"><span id="busuanzi_container_site_uv" class="lg:!block"><span class="text-sm">VISITOR COUNT</span> <span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" class="lg:!block"><span class="text-sm">TOTAL PAGE VIEWS</span> <span id="busuanzi_value_site_pv"></span></span></div><div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left"><span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span> <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.2</a></span></div><div>Blog up for <span class="odometer" id="runtime_days"></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec</div><script data-swup-reload-script>try{function odometer_init(){document.querySelectorAll(".odometer").forEach(e=>{new Odometer({el:e,format:"( ddd).dd",duration:200})})}odometer_init()}catch(e){}</script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="article-tools-list"><li class="right-bottom-tools page-aside-toggle"><i class="fa-regular fa-outdent"></i></li><li class="go-comment"><i class="fa-regular fa-comments"></i></li></ul></div></div><div class="right-side-tools-container"><div class="side-tools-container"><ul class="hidden-tools-list"><li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-plus"></i></li><li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-minus"></i></li><li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center"><i class="fa-regular fa-moon"></i></li><li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center"><i class="fa-regular fa-arrow-up"></i></li><li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center"><i class="fa-regular fa-arrow-down"></i></li></ul><ul class="visible-tools-list"><li class="right-bottom-tools toggle-tools-list flex justify-center items-center"><i class="fa-regular fa-cog fa-spin"></i></li></ul></div></div><div class="image-viewer-container"><img src=""></div></main><script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/libs/Swup.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/libs/SwupSlideTheme.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/libs/SwupScriptsPlugin.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/libs/SwupProgressPlugin.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/libs/SwupScrollPlugin.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/libs/SwupPreloadPlugin.min.js"></script><script>const swup=new Swup({plugins:[new SwupScriptsPlugin({optin:!0}),new SwupProgressPlugin,new SwupScrollPlugin({offset:80}),new SwupSlideTheme({mainElement:".main-content-body"}),new SwupPreloadPlugin],containers:["#swup"]})</script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/tools/imageViewer.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/utils.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/main.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/layouts/navbarShrink.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/tools/scrollTopBottom.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/tools/lightDarkSwitch.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/layouts/categoryList.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/tools/codeBlock.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/layouts/lazyload.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/tools/runtime.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/libs/odometer.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/assets/odometer-theme-minimal.css"><script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/libs/Typed.min.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/plugins/typed.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/libs/minimasonry.min.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/plugins/masonry.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/tools/tocToggle.js" data-swup-reload-script></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/layouts/toc.js" data-swup-reload-script></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/plugins/tabs.js" data-swup-reload-script></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/libs/moment-with-locales.min.js" data-swup-reload-script></script><script type="module" src="https://cdn.jsdelivr.net/npm/hexo-theme-redefine@2.8.2/source/js/build/layouts/essays.js" data-swup-reload-script></script></body></html>